<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movie Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      background-color: #f8f9fa;
      color: #212529;
    }
    .movie-header {
      background-size: cover;
      background-position: center;
      height: 60vh;
      position: relative;
      margin-bottom: 2rem;
      border-radius: 0.5rem;
      overflow: hidden;
    }
    .movie-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.3) 100%);
    }
    .movie-poster {
      border-radius: 0.5rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      max-height: 500px;
    }
    .movie-title {
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    .movie-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .movie-meta-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .rating-badge {
      background-color: #f5c518;
      color: #000;
      font-weight: bold;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
    }
    .genre-badge {
      background-color: #6c757d;
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 1rem;
      font-size: 0.8rem;
    }
    .section-title {
      font-weight: 600;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #dee2e6;
    }
    .cast-member {
      text-align: center;
      margin-bottom: 1rem;
    }
    .cast-photo {
      border-radius: 50%;
      width: 100px;
      height: 100px;
      object-fit: cover;
      margin-bottom: 0.5rem;
    }
    .similar-movie {
      cursor: pointer;
      transition: transform 0.2s;
    }
    .similar-movie:hover {
      transform: scale(1.03);
    }
    .back-button {
      position: absolute;
      top: 1rem;
      left: 1rem;
      z-index: 10;
    }
  </style>
</head>
<body>
<div class="container-fluid p-0">
  <!-- Movie Header with Backdrop -->
  <div class="movie-header" id="movie-backdrop">
    <a href="javascript:history.back()" class="btn btn-outline-light back-button">
      <i class="fas fa-arrow-left"></i> Back
    </a>
  </div>
</div>

<div class="container">
  <!-- Main Movie Info -->
  <div class="row mb-5">
    <div class="col-md-3">
      <img id="movie-poster" class="img-fluid movie-poster" src="" alt="Movie Poster">
    </div>
    <div class="col-md-9">
      <h1 id="movie-title" class="movie-title"></h1>
      <h4 id="movie-tagline" class="text-muted mb-3"></h4>

      <div class="movie-meta mb-4">
                    <span class="movie-meta-item">
                        <span id="movie-year"></span>
                    </span>
        <span class="movie-meta-item">
                        <i class="fas fa-clock"></i>
                        <span id="movie-runtime"></span>
                    </span>
        <span class="movie-meta-item">
                        <span class="rating-badge" id="movie-rating"></span>
                    </span>
        <span class="movie-meta-item">
                        <i class="fas fa-star" style="color: #f5c518;"></i>
                        <span id="movie-vote-count"></span> votes
                    </span>
      </div>

      <div id="movie-genres" class="mb-4"></div>

      <h5 class="section-title">Overview</h5>
      <p id="movie-overview" class="mb-4"></p>

      <div class="row">
        <div class="col-md-6">
          <h5 class="section-title">Details</h5>
          <p><strong>Status:</strong> <span id="movie-status"></span></p>
          <p><strong>Original Language:</strong> <span id="movie-language"></span></p>
          <p><strong>Budget:</strong> <span id="movie-budget"></span></p>
          <p><strong>Revenue:</strong> <span id="movie-revenue"></span></p>
        </div>
        <div class="col-md-6">
          <h5 class="section-title">Production</h5>
          <div id="movie-production"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cast Section -->
  <div class="row mb-5">
    <div class="col-12">
      <h3 class="section-title">Cast</h3>
      <div class="row" id="movie-cast"></div>
    </div>
  </div>

  <!-- Similar Movies -->
  <div class="row mb-5">
    <div class="col-12">
      <h3 class="section-title">Similar Movies</h3>
      <div class="row" id="similar-movies"></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let posterUrl="";
  document.addEventListener('DOMContentLoaded', () => {
    // Get movie data from URL
    const urlParams = new URLSearchParams(window.location.search);
    const movieDataStr = urlParams.get('data');


    if (!movieDataStr) {
      window.location.href = 'index.html';
      return;
    }

    try {
      const movieData = JSON.parse(decodeURIComponent(movieDataStr));
      displayMovieDetails(movieData);
      fetchAdditionalDetails(movieData.id);
    } catch (error) {
      console.error('Error parsing movie data:', error);
      window.location.href = 'index.html';
    }
  });

  function displayMovieDetails(movie) {
    // Set basic movie info
    document.getElementById('movie-title').textContent = movie.title;
    document.title = `${movie.title} | Movie Details`;

    if (movie.tagline) {
      document.getElementById('movie-tagline').textContent = movie.tagline;
    } else {
      document.getElementById('movie-tagline').style.display = 'none';
    }

    // Set poster image
    posterUrl = movie.poster_path
      ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`
      : 'https://via.placeholder.com/500x750?text=No+Poster';
    document.getElementById('movie-poster').src = posterUrl;

    // Set backdrop image
    if (movie.backdrop_path) {
      document.getElementById('movie-backdrop').style.backgroundImage =
        `url(https://image.tmdb.org/t/p/original${movie.backdrop_path})`;
    }

    // Set meta info
    document.getElementById('movie-year').textContent =
      movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A';
    document.getElementById('movie-runtime').textContent =
      movie.runtime ? `${movie.runtime} min` : 'N/A';
    document.getElementById('movie-rating').textContent =
      movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A';
    document.getElementById('movie-vote-count').textContent =
      movie.vote_count ? movie.vote_count.toLocaleString() : '0';

    // Set genres
    const genresContainer = document.getElementById('movie-genres');
    if (movie.genres && movie.genres.length > 0) {
      movie.genres.forEach(genre => {
        const badge = document.createElement('span');
        badge.className = 'genre-badge me-2';
        badge.textContent = genre.name;
        genresContainer.appendChild(badge);
      });
    } else {
      genresContainer.textContent = 'No genres available';
    }

    // Set overview
    document.getElementById('movie-overview').textContent =
      movie.overview || 'No overview available.';
  }

  async function fetchAdditionalDetails(movieId) {
    try {
      const API_KEY = '093bad0ff23dfec0ecf5204b988fe17c';
      const baseUrl = 'https://api.themoviedb.org/3/movie';

      // Fetch detailed movie info
      const detailsUrl = `${baseUrl}/${movieId}?api_key=${API_KEY}&append_to_response=credits,similar`;
      const response = await fetch(detailsUrl);

      if (!response.ok) {
        throw new Error('Failed to fetch movie details');
      }

      const data = await response.json();

      // Update movie details with additional info
      updateMovieDetails(data);

      // Display cast
      displayCast(data.credits.cast);

      // Display similar movies
      displaySimilarMovies(data.similar.results);

    } catch (error) {
      console.error('Error fetching additional details:', error);
    }
  }

  function updateMovieDetails(movie) {
    // Set status
    document.getElementById('movie-status').textContent = movie.status || 'N/A';

    // Set original language
    const language = new Intl.DisplayNames(['en'], { type: 'language' }).of(movie.original_language);
    document.getElementById('movie-language').textContent = language || movie.original_language || 'N/A';

    // Set budget and revenue
    document.getElementById('movie-budget').textContent =
      movie.budget ? `$${movie.budget.toLocaleString()}` : 'N/A';
    document.getElementById('movie-revenue').textContent =
      movie.revenue ? `$${movie.revenue.toLocaleString()}` : 'N/A';

    // Set production companies
    const productionContainer = document.getElementById('movie-production');
    if (movie.production_companies && movie.production_companies.length > 0) {
      movie.production_companies.forEach(company => {
        const p = document.createElement('p');
        p.textContent = company.name;
        productionContainer.appendChild(p);
      });
    } else {
      productionContainer.textContent = 'No production companies available';
    }
  }

  function displayCast(cast) {
    const castContainer = document.getElementById('movie-cast');

    if (!cast || cast.length === 0) {
      castContainer.innerHTML = '<p>No cast information available.</p>';
      return;
    }

    // Show top 10 cast members
    const topCast = cast.slice(0, 10);

    topCast.forEach(person => {
      const col = document.createElement('div');
      col.className = 'col-6 col-sm-4 col-md-3 col-lg-2 cast-member';


      const photoUrl = person.profile_path
        ? `https://image.tmdb.org/t/p/w200${person.profile_path}`
        : 'https://www.themoviedb.org/assets/2/v4/glyphicons/basic/glyphicons-basic-4-user-grey-d8fe957375e70239d6abdd549fd7568c89281b2179b5f4470e2e12895792dfa5.svg';

      col.innerHTML = `
                    <img src="${photoUrl}" alt="No photo" class="cast-photo img-fluid mb-2">
                    <h6>${person.name}</h6>
                    <p class="text-muted small">${person.character || 'Unknown'}</p>
                `;

      // Make cast member clickable
      col.style.cursor = 'pointer';
      col.addEventListener('click', () => {
        const actorDataStr = encodeURIComponent(JSON.stringify(person));
        window.location.href = `actor.html?data=${actorDataStr}`;
      });

      castContainer.appendChild(col);
    });
  }


</script>
</body>
</html>
